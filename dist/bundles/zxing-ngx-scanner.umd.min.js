!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@zxing/library"),require("@angular/core"),require("@angular/common"),require("@angular/forms")):"function"==typeof define&&define.amd?define(["exports","@zxing/library","@angular/core","@angular/common","@angular/forms"],t):t((e.zxing=e.zxing||{},e.zxing["ngx-scanner"]={}),e.library,e.ng.core,e.ng.common,e.ng.forms)}(this,function(e,t,n,i,o){"use strict";var s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};var r=function(e){function n(n){return void 0===n&&(n=500),e.call(this,new t.QRCodeReader,n)||this}return function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(n,e),n}(function(){function e(e,t){void 0===t&&(t=500),this.reader=e,this.timeBetweenScans=t}return e.prototype.decodeFromInputVideoDevice=function(e,t,n){var i=this;this.reset(),this.prepareVideoElement(n);var o={audio:!1,video:t===undefined?{facingMode:{exact:"environment"}}:{deviceId:{exact:t}}};navigator.mediaDevices.getUserMedia(o).then(function(t){return i.startDecodeFromStream(t,e)})["catch"](function(e){console.error(e),i.stop()})},e.prototype.startDecodeFromStream=function(e,t){var n=this;this.stream=e,"srcObject"in this.videoElement?this.videoElement.srcObject=this.stream:this.videoElement.src=window.URL.createObjectURL(e),this.videoPlayingEventListener=function(){n.decodeWithDelay(t)},this.videoElement.addEventListener("play",this.videoPlayingEventListener),this.videoLoadedMetadataEventListener=function(){n.videoElement.play()},this.videoElement.addEventListener("loadedmetadata",this.videoLoadedMetadataEventListener)},e.prototype.prepareVideoElement=function(e){e?this.videoElement=e:(this.videoElement=document.createElement("video"),this.videoElement.width=200,this.videoElement.height=200)},e.prototype.decodeWithDelay=function(e){(this.videoElement||this.imageElement)&&(this.timeoutHandler=window.setTimeout(this.decode.bind(this,e),this.timeBetweenScans))},e.prototype.decode=function(e,n,i,o){void 0===n&&(n=!0),void 0===i&&(i=!0),void 0===o&&(o=!1),undefined===this.canvasElementContext&&this.prepareCaptureCanvas(),this.canvasElementContext.drawImage(this.videoElement||this.imageElement,0,0);var s=new t.HTMLCanvasElementLuminanceSource(this.canvasElement),r=new t.BinaryBitmap(new t.HybridBinarizer(s));try{var a=this.readerDecode(r);e(a),!o&&this.stream&&this.decodeWithDelay(e)}catch(c){console.debug(i,c),n&&t.Exception.isOfType(c,t.Exception.NotFoundException)?(console.debug("zxing-scanner","QR-code not-found, trying again..."),this.decodeWithDelay(e)):i&&(t.Exception.isOfType(c,t.Exception.ChecksumException)||t.Exception.isOfType(c,t.Exception.FormatException))&&(console.warn("zxing-scanner","Checksum or format error, trying again...",c),this.decodeWithDelay(e))}},e.prototype.readerDecode=function(e){return this.reader.decode(e)},e.prototype.prepareCaptureCanvas=function(){var e,t,n=document.createElement("canvas");undefined!==this.videoElement?(e=this.videoElement.videoWidth,t=this.videoElement.videoHeight):(e=this.imageElement.naturalWidth||this.imageElement.width,t=this.imageElement.naturalHeight||this.imageElement.height),n.style.width=e+"px",n.style.height=t+"px",n.width=e,n.height=t,this.canvasElement=n,this.canvasElementContext=n.getContext("2d")},e.prototype.stop=function(){this.timeoutHandler&&(window.clearTimeout(this.timeoutHandler),this.timeoutHandler=null),this.stream&&(this.stream.getTracks()[0].stop(),this.stream=null)},e.prototype.reset=function(){this.stop(),this.videoElement&&(undefined!==this.videoPlayEndedEventListener&&this.videoElement.removeEventListener("ended",this.videoPlayEndedEventListener),undefined!==this.videoPlayingEventListener&&this.videoElement.removeEventListener("play",this.videoPlayingEventListener),undefined!==this.videoLoadedMetadataEventListener&&this.videoElement.removeEventListener("loadedmetadata",this.videoLoadedMetadataEventListener),this.videoElement.srcObject&&this.videoElement.srcObject.getTracks()[0].stop(),this.videoElement.srcObject=undefined,this.videoElement.removeAttribute("src"),this.videoElement=undefined),this.imageElement&&(undefined!==this.videoPlayEndedEventListener&&this.imageElement.removeEventListener("load",this.imageLoadedEventListener),this.imageElement.src=undefined,this.imageElement.removeAttribute("src"),this.imageElement=undefined),this.canvasElementContext=undefined,this.canvasElement=undefined},e}()),a=function(){function e(){this.codeReader=new r(1500),this.scanThrottling=1500,this.scannerEnabled=!0,this.autofocusEnabled=!0,this.scanSuccess=new n.EventEmitter,this.scanFailure=new n.EventEmitter,this.scanError=new n.EventEmitter,this.scanComplete=new n.EventEmitter,this.camerasFound=new n.EventEmitter,this.camerasNotFound=new n.EventEmitter,this.permissionResponse=new n.EventEmitter,this.isEnumerateDevicesSuported=!(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)}return e.prototype.ngOnChanges=function(e){e.scannerEnabled&&(this.scannerEnabled?this.videoInputDevice&&this.scan(this.videoInputDevice.deviceId):this.resetScan()),e.device&&(this.device?this.changeDevice(this.device):(console.warn("zxing-scanner","device","Unselected device."),this.resetScan())),e.scanThrottling&&this.setCodeReaderThrottling(this.scanThrottling)},e.prototype.ngAfterViewInit=function(){var e=this;this.previewElemRef?(this.previewElemRef.nativeElement.setAttribute("autoplay",!1),this.previewElemRef.nativeElement.setAttribute("muted",!0),this.previewElemRef.nativeElement.setAttribute("playsinline",!0),this.previewElemRef.nativeElement.setAttribute("autofocus",this.autofocusEnabled),this.askForPermission().subscribe(function(t){t?(e.enumarateVideoDevices(function(t){t&&t.length>0?e.camerasFound.next(t):e.camerasNotFound.next()}),e.startScan(e.videoInputDevice)):console.warn("User has denied permission.")})):console.warn("zxing-scanner","Preview element not found!")},e.prototype.ngOnDestroy=function(){this.resetScan()},e.prototype.setCodeReaderThrottling=function(e){this.codeReader=new r(e)},e.prototype.changeDevice=function(e){this.videoInputDevice=e,this.startScan(e)},e.prototype.changeDeviceById=function(e){this.changeDevice(this.getDeviceById(e))},e.prototype.getDeviceById=function(e){return this.videoInputDevices.find(function(t){return t.deviceId===e})},e.prototype.askForPermission=function(){var e=this;return navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then(function(t){try{e.previewElemRef.nativeElement.srcObject=t,t.getVideoTracks().forEach(function(e){e.stop()}),e.previewElemRef.nativeElement.srcObject=undefined,e.hasPermission=!0,e.permissionResponse.next(e.hasPermission)}catch(n){console.error("zxing-scanner","askForPermission",n),e.hasPermission=undefined,e.permissionResponse.next(undefined)}})["catch"](function(t){switch(console.warn("zxing-scanner","askForPermission",t),t.name){case"NotAllowedError":e.hasPermission=!1,e.permissionResponse.next(e.hasPermission);break;case"NotFoundError":e.camerasNotFound.next(t);break;default:e.permissionResponse.next(undefined)}}),this.permissionResponse},e.prototype.scan=function(e){var t=this;try{this.codeReader.decodeFromInputVideoDevice(function(e){console.debug("zxing-scanner","scan","result: ",e),e?t.dispatchScanSuccess(e):t.dispatchScanFailure(),t.dispatchScanComplete(e)},e,this.previewElemRef.nativeElement)}catch(n){this.dispatchScanError(n),this.dispatchScanComplete(undefined)}},e.prototype.startScan=function(e){this.scannerEnabled&&e&&this.scan(e.deviceId)},e.prototype.resetScan=function(){this.codeReader.reset()},e.prototype.dispatchScanSuccess=function(e){this.scanSuccess.next(e.getText())},e.prototype.dispatchScanFailure=function(){this.scanFailure.next()},e.prototype.dispatchScanError=function(e){this.scanError.next(e)},e.prototype.dispatchScanComplete=function(e){this.scanComplete.next(e)},e.prototype.enumarateVideoDevices=function(e){var t=this;this.isEnumerateDevicesSuported?navigator.mediaDevices.enumerateDevices().then(function(n){t.videoInputDevices=[];try{for(var i=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(n),o=i.next();!o.done;o=i.next()){var s=o.value,r={};for(var a in s)r[a]=s[a];"video"===r.kind&&(r.kind="videoinput"),r.deviceId||(r.deviceId=r.id),r.label||(r.label="Camera (no-permission)"),"videoinput"===r.kind&&t.videoInputDevices.push(r)}}catch(u){c={error:u}}finally{try{o&&!o.done&&(d=i["return"])&&d.call(i)}finally{if(c)throw c.error}}var c,d;e(t.videoInputDevices)}):console.error("zxing-scanner","enumarateVideoDevices","Can't enumerate devices, method not supported.")},e}();a.decorators=[{type:n.Component,args:[{selector:"zxing-scanner",template:'<video [ngClass]="cssClass" #preview>\n    <p>\n        Your browser does not support this feature, please try to upgrade it.\n    </p>\n    <p>\n        Seu navegador não suporta este recurso, por favor tente atualizá-lo.\n    </p>\n</video>\n',changeDetection:n.ChangeDetectionStrategy.OnPush}]}],a.ctorParameters=function(){return[]},a.propDecorators={previewElemRef:[{type:n.ViewChild,args:["preview"]}],scanThrottling:[{type:n.Input}],scannerEnabled:[{type:n.Input}],device:[{type:n.Input}],cssClass:[{type:n.Input}],autofocusEnabled:[{type:n.Input}],scanSuccess:[{type:n.Output}],scanFailure:[{type:n.Output}],scanError:[{type:n.Output}],scanComplete:[{type:n.Output}],camerasFound:[{type:n.Output}],camerasNotFound:[{type:n.Output}],permissionResponse:[{type:n.Output}]};var c=function(){function e(){}return e.forRoot=function(){return{ngModule:e}},e}();c.decorators=[{type:n.NgModule,args:[{imports:[i.CommonModule,o.FormsModule],declarations:[a],exports:[a]}]}],c.ctorParameters=function(){return[]},e.ZXingScannerModule=c,e.ɵa=a,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=zxing-ngx-scanner.umd.min.js.map
